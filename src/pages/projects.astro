---
import BaseLayout from "../layout/BaseLayout.astro";
import Screenshot from "../components/Screenshot.astro";
import IconLink from "../components/IconLink.astro";
import Tags from "../components/Tags.astro";

import { getCollection } from "astro:content";
const projects = await Promise.all(
  (await getCollection("projects"))
    .sort((a, b) => (b.data.featured ? 1 : 0) - (a.data.featured ? 1 : 0))
    .map(async (project) => {
      const { Content } = await project.render();
      return { ...project, Content };
    })
);
---

<BaseLayout
  title="My Projects"
  description="Explore my projects showcasing my skills in iOS development, CI/CD automation, and more. Each project highlights my approach to clean, reliable code and production-ready solutions."
>
  {
    projects.map(
      ({ data: { title, tags, links, articles, images }, slug, Content }) => (
        <section id={slug} class="card flex flex-col gap-4">
          <div class="flex flex-col gap-3 sm:flex-row sm:items-baseline">
            <h2 class="m-0">{title}</h2>

            <div class="flex items-center gap-2">
              {links?.map((link) => (
                <IconLink type={link.type} url={link.url} />
              ))}
            </div>
          </div>

          <Tags tags={tags} />

          <div class="prose dark:prose-invert max-w-none sm:text-justify">
            <Content />
          </div>

          {articles && articles?.length > 0 && (
            <div class="flex flex-row items-baseline gap-2">
              <h3>Related articles:</h3>
              {articles.map((article: string) => (
                <a
                  href={`/blog/${article}`}
                  class="inline-block responsive text-lg font-semibold"
                >
                  {article}
                </a>
              ))}
            </div>
          )}

          {images && (
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
              {images.map((img) => (
                <Screenshot src={`projects/${slug}/${img}`} alt={title} />
              ))}
            </div>
          )}
        </section>
      )
    )
  }
</BaseLayout>
