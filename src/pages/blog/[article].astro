---
import BaseLayout from "../../layout/BaseLayout.astro";
import DynamicImage from "../../components/DynamicImage.astro";
import Tags from "../../components/Tags.astro";

import { getCollection } from "astro:content";

export async function getStaticPaths() {
  return (await getCollection("blog"))
    .filter(
      ({ slug }) =>
        !(import.meta.env.DRAFT_ARTICLES?.split(",") ?? []).includes(slug)
    )
    .map((article) => ({
      params: { article: article.slug },
      props: article
    }));
}

const {
  data: { title, short, author, date, tags },
  slug,
  rendered
} = Astro.props;
---

<BaseLayout
  title={title}
  description={short}
  ldJson={{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    headline: title,
    description: short,
    author: author,
    datePublished: date.toISOString(),
    tags: tags?.join(", "),
    url: `https://leolem.dev/blog/${slug}`,
    inLanguage: "en"
  }}
>
  <DynamicImage
    slot="thumbnail"
    src={`blog/${slug}`}
    alt=""
    class="w-full max-w-3xl mx-auto rounded-2xl mb-8"
    loading="eager"
  />

  <div class="flex flex-col gap-4 max-w-3xl mx-auto -mt-16">
    <p class="text-muted font-semibold">
      by {author ?? "Leopold Lemmermann"} | {date.toLocaleDateString()}
    </p>
    <Tags tags={tags} class="justify-center" />
  </div>

  <article
    class="prose prose-lg dark:prose-invert text-start sm:text-justify"
    set:html={rendered?.html}
  />
</BaseLayout>
