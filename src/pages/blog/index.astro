---
import { getCollection } from "astro:content";

import BlogLayout from "../../layout/BlogLayout.astro";
import SubscribePanel from "../../components/SubscribePanel.astro";
import FeaturedArticle from "../../components/FeaturedArticle.astro";
import Article from "../../components/Article.astro";

const allArticles = (await getCollection("blog"))
  .filter(({ data: { date } }) => date <= new Date())
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const featured = allArticles.find(({ data: { featured } }) => featured);
const articles = allArticles.filter((article) => article !== featured);
---

<BlogLayout
  title="My Blog"
  description="Welcome to my blog. I write about building software, exploring systems, and learning in public. Expect posts on Swift, CI/CD, architecture, side projects, and personal reflections from whatever I'm working through."
>
  <section class="container">
    {
      featured && (
        <FeaturedArticle
          article={featured}
          class="responsive card card-elevated text-center"
        />
      )
    }
  </section>

  <SubscribePanel class="container-narrow stack-sm justify-center p-2" />

  <ul class="container-wide stack">
    {
      articles.map((article, idx) => (
        <li>
          <Article article={article} class={idx < 3 ? "eager" : "lazy"} />
        </li>
      ))
    }
  </ul>
</BlogLayout>
