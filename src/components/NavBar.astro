---
import { navigation } from "../navigation.config";
import Icon from "./Icon.astro";
import Thumbnail from "./Thumbnail.astro";
import { aboutMe } from "../content";

const { socials, subscribe = true } = Astro.props as {
  socials: string[];
  subscribe?: boolean;
};
---

<header class="sticky top-0 py-3 z-10 stack-sm">
  <nav
    class="w-full container-wide mx-auto flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
    data-testid="nav"
  >
    <div class="w-full flex items-center justify-between gap-4">
      <Thumbnail
        src="profile"
        alt="Profile picture of Leopold Lemmermann"
        class="w-10 h-10 rounded-full object-cover shadow-[0_8px_20px_rgba(0,0,0,0.6)]"
        loading="eager"
      />

      <a
        href="/"
        class="flex flex-col navigation animate-slidefadein hover:text-accent"
      >
        <span class="font-semibold text-xs sm:text-sm">
          Leopold Lemmermann
        </span>
        <span class="text-xs whitespace-nowrap">
          {aboutMe.titles.join(" Â· ")}
        </span>
      </a>

      <div class="ml-auto"></div>

      {
        socials.map((url: string) => (
          <Icon name={url} class="icon-sm animate-slidefadein" />
        ))
      }

      <button
        id="mobile-menu-toggle"
        class="sm:hidden focus:outline-none"
        aria-label="Open menu"
        aria-controls="mobile-menu"
        aria-expanded="false"
      >
        <Icon name="lucide:menu" class="icon-sm animate-slidefadein" />
      </button>
    </div>

    <div
      id="mobile-menu"
      class="hidden max-h-0 overflow-hidden transition-[max-height] duration-300 ease-in-out flex-col items-center gap-2 sm:flex sm:flex-row sm:overflow-visible sm:animate-slidefadein"
    >
      {
        navigation.map((item) => (
          <a
            href={`/${item}/`}
            class={`navigation capitalize hover:text-accent ${Astro.url.pathname.includes(item) ? "active" : ""}`}
            aria-current={
              Astro.url.pathname.includes(item) ? "page" : undefined
            }
            data-testid={`nav-link-${item}`}
          >
            {item}
          </a>
        ))
      }
    </div>
  </nav>

  {
    subscribe && (
      <section class="container-wide mx-auto text-center text-muted">
        New article weekly. No noise.{" "}
        <a href="/blog/#subscribe" class="text-primary hover:text-accent">
          Subscribe
        </a>
      </section>
    )
  }
</header>

<style>
  header {
    @apply shadow shadow-[var(--shadow-color)];
    color: var(--text-color);
    background-color: var(--base-color);
    border-color: var(--border-color);
  }

  header a.active {
    @apply font-bold underline;
  }
</style>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("mobile-menu-toggle");
    const menu = document.getElementById("mobile-menu");

    toggle?.addEventListener("click", () => {
      const isHidden = menu?.classList.contains("hidden");

      if (isHidden) {
        menu.classList.remove("hidden");
        menu.classList.add("flex");
        menu.style.maxHeight = menu.scrollHeight + "px";
        toggle.setAttribute("aria-expanded", "true");
        toggle.setAttribute("aria-label", "Close menu");
      } else {
        menu.style.maxHeight = "0px";
        toggle.setAttribute("aria-expanded", "false");
        toggle.setAttribute("aria-label", "Open menu");
        setTimeout(() => {
          menu.classList.remove("flex");
          menu.classList.add("hidden");
        }, 300);
      }
    });
  });
</script>
